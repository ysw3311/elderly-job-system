from datetime import datetime, timedelta
import random

def init_db(db, Senior, Company, Government, JobPosting, Application, EmploymentHistory):
    
    # ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if Government.query.filter_by(gov_id='gov_admin').first():
        print("ğŸš¨ ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ˆê¸°í™”ë¥¼ ì›í•˜ë©´ DB íŒŒì¼ì„ ì‚­ì œí•˜ê±°ë‚˜ drop_all í›„ ì¬ì‹¤í–‰í•˜ì„¸ìš”.")
        return

    print("ğŸš€ ì‹œì—°ìš© ì´ˆê¸° ë°ì´í„°(ì„œìš¸ ì „ì—­ ë‹¤ì–‘í™”) ìƒì„± ì¤‘...")

    # ==========================================
    # 1. ì •ë¶€ (Government)
    # ==========================================
    gov = Government(
        gov_id='gov_admin',
        gov_password='1234',
        name='ì„œìš¸ì‹œ ì–´ë¥´ì‹ ì·¨ì—…ì§€ì›ì„¼í„°',
        tel='02-123-4567',
        department='ì¼ìë¦¬ì‚¬ì—…ë³¸ë¶€',
        email='admin@seoul.go.kr'
    )
    db.session.add(gov)

    # ==========================================
    # 2. ì‹œë‹ˆì–´ (Senior) - í…ŒìŠ¤íŠ¸ ê³„ì •
    # ==========================================
    # (1) ë©”ì¸ ì‹œì—°ìš© ê³„ì • (ê°•ë‚¨êµ¬ ê±°ì£¼)
    senior_main = Senior(
        senior_id='senior1',
        password='1234',
        name='ê¹€ì² ìˆ˜',
        phone='010-1234-5678',
        birth_date=datetime.strptime('1955-03-15', '%Y-%m-%d').date(),
        gender='male',
        address='ì„œìš¸ ê°•ë‚¨êµ¬ ì‚¼ì„±ë™ 123',
        location='ì„œìš¸ ê°•ë‚¨êµ¬', # í¬ë§ ê·¼ë¬´ì§€
        employment_type='both',
        work_days='MON,WED,FRI',
        work_hours='09:00-13:00',
        work_period='6'
    )

    # (2) ë³´ì¡° ê³„ì • (ë§ˆí¬êµ¬ ê±°ì£¼ - ë¹„êµìš©)
    senior_sub = Senior(
        senior_id='senior2',
        password='1234',
        name='ì´ì˜í¬',
        phone='010-9876-5432',
        birth_date=datetime.strptime('1960-07-20', '%Y-%m-%d').date(),
        gender='female',
        address='ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™ 456',
        location='ì„œìš¸ ë§ˆí¬êµ¬',
        employment_type='office'
    )
    db.session.add_all([senior_main, senior_sub])
    db.session.commit()

    # ==========================================
    # 3. ê¸°ì—… & ê³µê³  (30ê°œ - ì„œìš¸ ë‹¤ì–‘í•œ ì§€ì—­ ë¶„í¬)
    # ==========================================
    
    # (êµ¬, ë™) ë¦¬ìŠ¤íŠ¸ - ê°•ë‚¨êµ¬ë¥¼ í¬í•¨í•˜ë˜, ë‹¤ë¥¸ ì§€ì—­ë„ ì„ìŒ
    seoul_locations = [
        ("ê°•ë‚¨êµ¬", "ì—­ì‚¼ë™"), ("ê°•ë‚¨êµ¬", "ì‚¼ì„±ë™"), ("ê°•ë‚¨êµ¬", "ì²­ë‹´ë™"), ("ê°•ë‚¨êµ¬", "ë…¼í˜„ë™"),
        ("ì„œì´ˆêµ¬", "ì„œì´ˆë™"), ("ì„œì´ˆêµ¬", "ì–‘ì¬ë™"), ("ì„œì´ˆêµ¬", "ë°˜í¬ë™"),
        ("ì†¡íŒŒêµ¬", "ì ì‹¤ë™"), ("ì†¡íŒŒêµ¬", "ê°€ë½ë™"), ("ì†¡íŒŒêµ¬", "ë¬¸ì •ë™"),
        ("ë§ˆí¬êµ¬", "í•©ì •ë™"), ("ë§ˆí¬êµ¬", "ìƒì•”ë™"), ("ë§ˆí¬êµ¬", "ë§ì›ë™"),
        ("ì¢…ë¡œêµ¬", "í˜œí™”ë™"), ("ì¢…ë¡œêµ¬", "ì¢…ë¡œ1ê°€"),
        ("ì¤‘êµ¬", "ì„ì§€ë¡œ"), ("ì¤‘êµ¬", "ëª…ë™"),
        ("ìš©ì‚°êµ¬", "ì´íƒœì›ë™"), ("ìš©ì‚°êµ¬", "í•œê°•ë¡œ"),
        ("ì˜ë“±í¬êµ¬", "ì—¬ì˜ë„ë™"), ("ì˜ë“±í¬êµ¬", "ë‹¹ì‚°ë™"),
        ("ì„±ë™êµ¬", "ì„±ìˆ˜ë™"), ("ê´‘ì§„êµ¬", "ê±´ëŒ€ì…êµ¬"),
        ("ê°•ì„œêµ¬", "ë§ˆê³¡ë™"), ("ê´€ì•…êµ¬", "ì‹ ë¦¼ë™")
    ]

    # ê¸°ì—… ë°ì´í„° ë¦¬ìŠ¤íŠ¸ (ì´ë¦„, ì—…ì¢…)
    company_data_list = [
        ("ì‹¤ë²„ íƒë°°", "ë¬¼ë¥˜/ë°°ì†¡"), ("í–‰ë³µ ìš”ì–‘ë³‘ì›", "ì˜ë£Œ/ê°„ë³‘"), ("ìŠ¤íƒ€ ì¹´í˜", "ì„œë¹„ìŠ¤/ë§¤ì¥"),
        ("ì•ˆì „ ì§€í‚´ì´", "ê²½ë¹„/ë³´ì•ˆ"), ("í‘¸ë¥¸ ì¡°ê²½", "ì‹œì„¤/ê±´ì„¤"), ("êµ¬ë¦½ ë„ì„œê´€", "ê³µê³µ/í–‰ì •"),
        ("ìš°ë¦¬ ë§ˆíŠ¸", "ìœ í†µ/íŒë§¤"), ("ê¹¨ë—í•œ ê±°ë¦¬ ì²­ì†Œ", "ë¯¸í™”/ì²­ì†Œ"), ("ë°œë ›íŒŒí‚¹ ì„œë¹„ìŠ¤", "ì£¼ì°¨/ìš´ì „"),
        ("ë³µì§€ê´€ ê°•ì‚¬", "êµìœ¡/ê°•ì‚¬"), ("ì§€í•˜ì²  ì•ˆë‚´ì„¼í„°", "ì„œë¹„ìŠ¤/ì•ˆë‚´"), ("ë¹Œë”© ê´€ë¦¬", "ì‹œì„¤ê´€ë¦¬"),
        ("ë¯¸ìˆ ê´€ ì•ˆë‚´", "ì•ˆë‚´/ë°ìŠ¤í¬"), ("êµ¬ë‚´ì‹ë‹¹", "ìš”ë¦¬/ì¡°ë¦¬"), ("ì£¼ìœ ì†Œ", "ì„œë¹„ìŠ¤"),
        ("ì „í†µì‹œì¥ ë²ˆì˜íšŒ", "ê¸°íƒ€"), ("ì „ì‹œì¥ ìš´ì˜ë³´ì¡°", "í–‰ì‚¬ë³´ì¡°"), ("ì§€í•˜ì²  ë¯¸í™”", "ë¯¸í™”"),
        ("ê¸‰ì‹ ì„¼í„°", "ë°°ì‹"), ("ìˆ² ì²´í—˜ì¥", "ì•ˆì „ê´€ë¦¬"), ("ì£¼ë§ ë†ì¥", "ë‹¨ìˆœë…¸ë¬´"),
        ("ë¬¼ë¥˜ ì°½ê³ ", "ë¶„ë¥˜/í¬ì¥"), ("ë…¸ì¸ ì¼€ì–´ ì„¼í„°", "ë³´ì¡°"), ("ë³´ê±´ì†Œ", "í–‰ì •ì§€ì›"),
        ("í™˜ê²½ ì§€í‚´ì´", "í™˜ê²½ì •í™”"), ("ì•„íŒŒíŠ¸ ê´€ë¦¬ì†Œ", "ì‹œì„¤ë³´ì¡°"), ("ê³µì› ë§¤í‘œì†Œ", "ë§¤í‘œ/ì•ˆë‚´"),
        ("ì§€í•˜ìƒê°€ ê´€ë¦¬", "ê²½ë¹„"), ("íŒì—… ìŠ¤í† ì–´", "ê´€ë¦¬"), ("ëŒ€ë‹¨ì§€ ì•„íŒŒíŠ¸", "ê²½ë¹„")
    ]

    companies = []
    jobs = []

    # 30ê°œ ìƒì„± ë£¨í”„
    for i in range(30):
        # 1. ì§€ì—­ ëœë¤ í• ë‹¹ (ê°•ë‚¨êµ¬ ë¹„ì¤‘ì„ ì¡°ê¸ˆ ë†’ê²Œ í•˜ë ¤ë©´ ë¦¬ìŠ¤íŠ¸ ì¡°ì ˆ ê°€ëŠ¥)
        gu, dong = seoul_locations[i % len(seoul_locations)]
        name, sector = company_data_list[i]
        
        # ê¸°ì—…ëª…ì— ì§€ì—­ëª… ë¶™ì—¬ì„œ ê·¸ëŸ´ì‹¸í•˜ê²Œ ë§Œë“¤ê¸°
        full_company_name = f"{dong} {name}"
        comp_id = f"company_{i+1}"
        
        comp = Company(
            company_id=comp_id,
            company_pw='1234',
            name=full_company_name,
            business_number=f"120-81-{10000+i}",
            address=f"ì„œìš¸ {gu} {dong} 10-{i}ë²ˆì§€", # ìƒì„¸ ì£¼ì†Œ
            phone=f"02-555-{1000+i}"
        )
        db.session.add(comp)
        companies.append(comp)

        # 2. ê³µê³  ìƒì„±
        wage = random.choice([10030, 11000, 12000, 15000, 10500])
        # ì‹œì—°ì„ ìœ„í•´ 'field', 'office', 'both' ê³¨ê³ ë£¨ ì„ìŒ
        emp_type = 'field' if i % 3 == 0 else ('office' if i % 3 == 1 else 'both')
        
        # ê·¼ë¬´ ìš”ì¼ ë‹¤ì–‘í™”
        days_pool = ['MON,WED,FRI', 'TUE,THU', 'MON,TUE,WED,THU,FRI', 'SAT,SUN', 'MON,WED', 'TUE,THU,SAT']
        
        job = JobPosting(
            company_id=comp_id,
            job_title=f"{gu} {dong} - {sector} ì–´ë¥´ì‹  ëª¨ì§‘",
            job_description=f"ì„œìš¸ {gu} {dong} ì¸ê·¼ ê±°ì£¼ì ìš°ëŒ€í•©ë‹ˆë‹¤.\nì„±ì‹¤í•˜ê²Œ ê·¼ë¬´í•´ì£¼ì‹¤ ì‹œë‹ˆì–´ ë¶„ì„ ëª¨ì‹­ë‹ˆë‹¤.\nì£¼ìš”ì—…ë¬´: {sector} ê´€ë ¨ ë³´ì¡° ì—…ë¬´",
            
            location=f"ì„œìš¸ {gu}", # âœ… í•µì‹¬: 'ì„œìš¸ ê°•ë‚¨êµ¬', 'ì„œìš¸ ë§ˆí¬êµ¬' ë“±ìœ¼ë¡œ ì €ì¥ë¨
            
            employment_type=emp_type,
            wage_type='ì‹œê¸‰',
            wage_amount=wage,
            work_days=days_pool[i % len(days_pool)],
            work_hours='09:00-13:00' if i % 2 == 0 else '13:00-18:00',
            work_period=random.choice(['3ê°œì›”', '6ê°œì›”', '12ê°œì›”']),
            status_name='approved',
            deadline_date=(datetime.now() + timedelta(days=30)).date(),
            gov_id='gov_admin'
        )
        db.session.add(job)
        jobs.append(job)

    db.session.commit()

    # ==========================================
    # 4. ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° (ì§€ì› ì´ë ¥)
    # ==========================================
    # senior1(ê°•ë‚¨êµ¬ ê±°ì£¼) -> ê°•ë‚¨êµ¬ì— ìˆëŠ” ì²« ë²ˆì§¸ ê¸°ì—…(0ë²ˆ ì¸ë±ìŠ¤)ì— í•©ê²©í–ˆë‹¤ê³  ê°€ì •
    if jobs and jobs[0].location == 'ì„œìš¸ ê°•ë‚¨êµ¬':
        app1 = Application(
            job_id=jobs[0].job_id,
            senior_id='senior1',
            status='approved',
            application_date=datetime.now() - timedelta(days=10),
            notes='ìš°ìˆ˜ ì¸ì¬'
        )
        db.session.add(app1)
        db.session.commit()

        hist1 = EmploymentHistory(
            application_id=app1.application_id,
            start_date=(datetime.now() - timedelta(days=5)).date(),
            status='active',
            verified_at=datetime.now()
        )
        db.session.add(hist1)

    print("âœ… ì´ˆê¸° ë°ì´í„° ìƒì„± ì™„ë£Œ! (ì„œìš¸ ì „ì—­ 30ê°œ ê¸°ì—…)")